#!/usr/bin/env ruby --disable-all
# frozen_string_literal: true

trap(2) { exit(138) }

WIDTH = [ENV['WIDTH'].to_i, 10].max
HEIGHT = [ENV['HEIGHT'].to_i, 6].max

def weighted(**definitions)
  definitions = definitions.flat_map { |k, c| Array.new(c, k) }
  Enumerator.new { _1 << definitions.sample.sample while true }
end

def as_line(chars) = chars.take(WIDTH).join
def as_array(chars, height:) = Array.new(height) { chars.take(WIDTH).join }

puts(
  as_array(weighted(["\u3000"] => 100, %w[ðŸ¡ ðŸ  ðŸŸ] => 20), height: 2).insert(
    1,
    as_array(
      weighted(["\u3000"] => 100, %w[ðŸ¡ ðŸ  ðŸŸ] => 20, %w[ðŸ™ ðŸ¦‘ ðŸ¦ˆ ðŸ¬] => 1),
      height: HEIGHT - 3
    )
  ) << as_line(
    weighted(
      %w[ðŸŒ± ðŸŒ¿] => 80,
      ["\u3000"] => 60,
      %w[ðŸŒ¾] => 40,
      %w[ðŸª¨ ðŸš ðŸŒ] => 8,
      %w[ðŸ¦‘ ðŸ¦ ðŸ¦ž ðŸ¦€] => 5,
      %w[ðŸ’° ðŸ° âš“ï¸ ðŸŽ± ðŸŽ² ðŸŽ® ðŸ—¿ ðŸ”± ðŸŽ· ðŸ—½ ðŸ’Ž ðŸ’° ðŸ”” ðŸ’€ ðŸ’© ðŸª ] => 2
    )
  )
)
