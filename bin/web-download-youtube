#! /bin/bash

set -e

if [ "$1" = '--help' ]; then echo "Usage: ${0##*/} [OPTIONS] URL

Download a (YouTube) video.

Options:
 -v | --video   download video to $HOME/Movies (default)
 -a | --audio   download audio to $HOME/Music
"
	exit 0
fi

if [ $# = 0 ]; then
	(>&2 echo "${0##*/}: URL missing")
	exit 1
fi

if [ "$(which youtube-dl)" = '' ]; then
	(>&2 echo "${0##*/}: 'youtube-dl' not installed")
	exit 2
fi

path=$HOME/Movies
options="--format mp4 --geo-bypass"

if [ "$1" = '-v' ] || [ "$1" = '--video' ]
then
	shift
elif [ "$1" = '-a' ] || [ "$1" = '--audio' ]
then
	path=$HOME/Music
	options="--extract-audio --audio-format mp3 --audio-quality 0 --embed-thumbnail --add-metadata --geo-bypass"
	shift
fi

pushd "$path" >/dev/null
youtube-dl $options "$1"
popd >/dev/null
