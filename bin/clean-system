#! /bin/sh

set -e

[ "$1" = '--help' ] && echo "Usage: ${0##*/}

Clean system. (May require password.)" && exit

echo '❗️ clean all stuff'

cleanup() {
  trap - INT TERM EXIT
}
trap cleanup INT TERM EXIT

while true; do
	sudo -n true
	sleep 60
	kill -0 "$$" || exit
done 2>/dev/null &

type 'brew' >/dev/null 2>&1 && echo '→ clean brew stuff...' && clean-brew
type 'docker' >/dev/null 2>&1 && echo '→ clean Docker...' && clean-docker
type 'npm' >/dev/null 2>&1 && echo '→ clean NPM...' && clean-npm
type 'yarn' >/dev/null 2>&1 && echo '→ clean Yarn...' && clean-yarn

echo '→ clean gems...' && clean-gems
echo '→ remove system log files...' && clean-logs
echo '→ clean all library caches...' && clean-caches
echo '→ cleanup XCode derived data and archives...' && clean-xcode
echo '→ clean Trashes...' && clean-trashes
