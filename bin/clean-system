#! /bin/sh

set -e

if [ "$1" = '--help' ]; then echo "Usage: ${0##*/}

Clean system. (May require password.)
"
  exit
fi

trap cleanup SIGINT SIGTERM ERR EXIT
cleanup() {
	trap - SIGINT SIGTERM ERR EXIT
}

while true; do
	sudo -n true
	sleep 60
	kill -0 "$$" || exit
done 2>/dev/null &

echo '❗️ clean all stuff'

echo '→ clean Trashes...'
clean-trashes

echo '→ remove system log files...'
clean-logs

echo '→ clean all library caches...'
clean-caches

echo '→ cleanup XCode derived data and archives...'
clean-xcode

if type 'brew' >/dev/null 2>&1
then
  echo '→ clean brew stuff...'
  clean-brew
fi

if type 'gem' >/dev/null 2>&1
then
  echo '→ clean gems...'
  clean-gems
fi

if type 'docker' >/dev/null 2>&1
then
  echo '→ clean Docker...'
  clean-docker
fi

if type 'npm' >/dev/null 2>&1
then
  echo '→ clean NPM...'
  clean-npm
fi

if type 'yarn' >/dev/null 2>&1
then
  echo '→ clean Yarn...'
  clean-yarn
fi
