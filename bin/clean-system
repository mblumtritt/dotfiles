#! /bin/sh

set -e

if [ "$1" = '--help' ]
then echo "Usage: ${0##*/}

Clean system. (May require password.)
"
  exit
fi

trap cleanup INT TERM EXIT
cleanup() {
  trap - INT TERM EXIT
}

while true; do
	sudo -n true
	sleep 60
	kill -0 "$$" || exit
done 2>/dev/null &

echo '❗️ clean all stuff'

if type 'brew' >/dev/null 2>&1
then echo '→ clean brew stuff...' && clean-brew
fi

if type 'docker' >/dev/null 2>&1
then echo '→ clean Docker...' && clean-docker
fi

if type 'npm' >/dev/null 2>&1
then echo '→ clean NPM...' && clean-npm
fi

if type 'yarn' >/dev/null 2>&1
then echo '→ clean Yarn...' && clean-yarn
fi

echo '→ clean gems...' && clean-gems
echo '→ remove system log files...' && clean-logs
echo '→ clean all library caches...' && clean-caches
echo '→ cleanup XCode derived data and archives...' && clean-xcode
echo '→ clean Trashes...' && clean-trashes
