#! /bin/sh

if [ "$1" = '--help' ]; then echo "Usage: ${0##*/} [--all]

Clean up Ruby gems. Option '--all' removes all installed gems,
"
  exit
fi

with_rbenv() {
  for ruby in $(rbenv versions --bare); do
    echo ":: Ruby $ruby"
    RBENV_VERSION="$ruby" rbenv exec $*
  done
}

with_asdf() {
	for ruby in $(asdf list ruby); do
    ruby="${ruby#\*}"
    echo "â€¢ Ruby $ruby"
    ASDF_RUBY_VERSION="$ruby" asdf exec $*
	done
}

CMD='gem cleanup'
if [ "$1" = "--all" ]; then CMD='gem uninstall -aIx'; fi
if type 'rbenv' >/dev/null 2>&1; then with_rbenv "$CMD"; fi
if type 'asdf' >/dev/null 2>&1; then with_asdf "$CMD"; fi
