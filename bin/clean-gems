#! /bin/sh

[ "$1" = '--help' ] && echo "Usage: ${0##*/} [--all]

Clean up Ruby gems. Option '--all' removes all installed gems." && exit

with_rbenv() {
  for ruby in $(rbenv versions --bare); do
    echo ":: Ruby $ruby"
    RBENV_VERSION="$ruby" rbenv exec $@
  done
}

with_asdf() {
	for ruby in $(asdf list ruby); do
    ruby="${ruby#\*}"
    echo "â€¢ Ruby $ruby"
    ASDF_RUBY_VERSION="$ruby" asdf exec $@
	done
}

CMD='gem cleanup'
[ "$1" = "--all" ] && CMD='gem uninstall -aIx'
type 'rbenv' >/dev/null 2>&1 && with_rbenv "$CMD"
type 'asdf' >/dev/null 2>&1 && with_asdf "$CMD"
