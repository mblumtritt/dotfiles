#! /bin/bash

set -e

if [ "$1" = '--help' ]; then echo "Usage: ${0##*/} [OPTIONS] URL

Download a file from given URL.

Options:
 -f | --file    download as is to $HOME/Downloads (*default)
 -v | --video   download video as mp4 to $HOME/Movies
 -a | --audio   download audio as mp3 to $HOME/Music
"
  exit 0
fi

if [ $# = 0 ]; then
	(>&2 echo "${0##*/}: URL missing")
	exit 1
fi

trap 'exit 130' INT HUP TERM

function exec_in()
{
  pushd "$HOME/$1" >/dev/null
  $2 "$3"
  popd >/dev/null
}

if [ "$1" = "-v" ] || [ "$1" = "--video" ]
then
  exec_in "Movies" "youtube-dl --format mp4 --geo-bypass" "$2"
  exit 0
fi

if [ "$1" = "-a" ] || [ "$1" = "--audio" ]
then
  exec_in "Music" "youtube-dl --extract-audio --audio-format mp3 --audio-quality 0 --embed-thumbnail --add-metadata --geo-bypass" "$2"
  exit 0
fi

if [ "$1" = "-f" ] || [ "$1" = "--file" ]
then
  shift
fi

exec_in "Downloads" "curl -LO" "$1"
