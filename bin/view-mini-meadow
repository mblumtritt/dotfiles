#!/usr/bin/env ruby --disable-all
# frozen_string_literal: true

trap(2) { exit(138) }

WIDTH = [ENV['WIDTH'].to_i, 10].max
HEIGHT = [ENV['HEIGHT'].to_i, 6].max

def weighted(**definitions)
  sum = 0
  elements = definitions.keys
  weights = definitions.values.map! { sum += _1 }
  Enumerator.new do |y|
    while true
      rnd = rand(sum) + 1
      y << elements[weights.bsearch_index { rnd <= _1 }].sample
    end
  end
end

obj = weighted(%w[ðŸŒ± ðŸŒ¿ ðŸ€] => 100, ["\u3000"] => 8, %w[ðŸŒ¼ ðŸŒ» ðŸŒ¸ ðŸŒº] => 5, %w[ðŸ„] => 1)
meadow = Array.new(HEIGHT) { obj.take(WIDTH) }

animals = {
  'ðŸ‡' => 'ðŸ¥•',
  'ðŸˆ' => 'ðŸ¥“',
  'ðŸ€' => 'ðŸ§€',
  'ðŸ' => 'ðŸ§€',
  'ðŸ“' => 'ðŸŒ½',
  'ðŸ¢' => 'ðŸ¥—',
  'ðŸ¿ï¸' => 'ðŸŒ°',
  'ðŸ’' => 'ðŸŒ',
  'ðŸ¦”' => nil,
  'ðŸ¦¡' => nil,
  'ðŸŒ' => nil,
  'ðŸ' => nil,
  'ðŸ' => nil,
  'ðŸ¦‹' => nil,
  'ðŸ¦Ž' => nil,
  'ðŸž' => nil,
  'ðŸª²' => nil,
  'ðŸ¦—' => nil,
  'ðŸœ' => nil
}
meadow[row = rand(HEIGHT)][col = rand(WIDTH)] = (a = animals.keys.sample)
if (tr = animals[a]) && (r = rand(HEIGHT)) != row && (c = rand(WIDTH)) != col
  meadow[r][c] = tr
end

puts(meadow.map!(&:join))
