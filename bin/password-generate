#!/usr/bin/env ruby
# frozen_string_literal: true

NAME = File.basename(__FILE__)

def help
  puts <<~HELP
    usage: #{NAME} [-s | --short]

    Generate a nice password of 32 (short) or 64 byte size
  HELP
  exit 0
end

help if ARGV[0] == '--help' || ARGV[0] == '-h'

SIZE = (ARGV[0] == '--short' || ARGV[0] == '-s') ? 32 : 64
ALPHABET =
  (
    ('a'..'z').to_a +
    ('a'..'z').to_a +
    ('a'..'z').to_a +
    ('a'..'z').to_a +
    ('0'..'9').to_a +
    ('A'..'Z').to_a
  )
  .shuffle!
  .freeze

def word(size)
  Array.new(size){ ALPHABET.sample }
end

def passwd(size)
  len = size - 8
  ret = []
  ret += word(rand(5..8)) << ' ' while ret.size < len
  len = size - ret.size
  return passwd(size) if len < 4
  (ret += word(len)).join
end

puts passwd(SIZE)
